\section{Przewidywanie parametrów HRV oraz RSA, przy u¿yciu sieci neuronowej opartej na cechach}\label{RRsiec}

\subsection{Wprowadzenie}
Jako etap poœredni w tworzeniu sieci end-to-end do przewidywania miar HRV i RSA
na podstawie sygna³u z Polara H10 opracowano model, który przewiduje te miary
na podstawie interwa³ów RR. Docelowym zamiarem by³o zintegrowanie tego modelu z
sieci¹ UNet w jeden kompleksowy system end-to-end. Próby stworzenia takiej
sieci jednak nie przynios³y oczekiwanych rezultatów. Za przyczynê uznano
z³o¿onoœæ procesu przetwarzania wyników wymaganego przez sieæ UNet, którego
implementacji jako wewnêtrznej warstwy modelu nie uda³o siê zrealizowaæ.

Niniejszy eksperyment stanowi wiêc jedynie „proof of concept” - analizuje on
wyniki dwóch roz³¹cznych sieci dzia³aj¹cych razem. Stanowi równie¿ punkt
odniesienia dla modelu end-to-end, omawianego w ramach nastêpnego eksperymentu.

\subsection{Definicja miar oceny modeli}
Do analizy uzyskanych wyników zastosowano nastêpuj¹ce miary:

\begin{itemize}
    \item Œredni b³¹d bezwzglêdny (Mean Absolute Error, MAE): Œrednia arytmetyczna wartoœci bezwzglêdnych ró¿nic miêdzy wartoœciami rzeczywistymi a przewidywanymi.
          \begin{equation}
              \text{MAE} = \frac{1}{n} \sum_{i=1}^n |y_i - \hat{y}_i|
          \end{equation}

    \item B³¹d œredniokwadratowy (Mean Squared Error, MSE): Œrednia arytmetyczna
          kwadratów ró¿nic miêdzy wartoœciami rzeczywistymi a przewidywanymi,
          podkreœlaj¹ca wiêksze b³êdy.
          \begin{equation}
              \text{MSE} = \frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2
          \end{equation}

    \item Pierwiastek ze œredniego b³êdu kwadratowego (Root Mean Squared Error, RMSE):
          Pierwiastek kwadratowy z MSE, interpretowany w tych samych jednostkach, co dane
          wejœciowe.
          \begin{equation}
              \text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}
          \end{equation}

    \item Wspó³czynnik determinacji ($R^2$): Miara jakoœci dopasowania modelu do danych.
          Reprezentuje jaka czêœæ zmiennoœæi wartoœci w danych jest wyjaœniana przez
          model. Wartoœæ $R^2$ przyjmuje wartoœci z zakresu od $-\infty$ do 1, gdzie 1 oznacza
          idealne dopasowanie, a wartoœci poni¿ej 0 œwiadcz¹, ¿e lepiej poradzi³aby sobie zwyk³a œrednia.

          \begin{equation}
              R^2 = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2}
          \end{equation}
          gdzie:
          \begin{itemize}
              \item \( n \) – liczba analizowanych wartoœci,
              \item \( y_i \) – wartoœæ rzeczywista dla i-tej obserwacji,
              \item \( \hat{y}_i \) – wartoœæ przewidywana przez model dla i-tej obserwacji,
              \item \( \bar{y} \) – œrednia wartoœæ rzeczywistych obserwacji.
          \end{itemize}
\end{itemize}

\subsection{Metodologia}
W ramach tego eksperymentu obie sieci funkcjonuj¹ w uk³adzie kaskadowym. W
pierwszym etapie wariant sieci UNet, wytrenowany na zaszumionym zbiorze danych
(którego skutecznoœæ by³a oceniana w poprzednim eksperymencie), wykrywa szczyty
R w sygnale EKG. Na podstawie tych detekcji obliczane s¹ interwa³y RR, które
nastêpnie dzielone s¹ na okna czasowe. Te okna stanowi¹ wejœcie do drugiej
sieci, odpowiedzialnej za obliczanie miar HRV i RSA. D³ugoœæ ka¿dego okna
ustalono na 300 próbek interwa³ów RR, co odpowiada oko³o 5 minutom pracy serca
przy œrednim pulsie wynosz¹cym 60 uderzeñ na minutê. Jakoœæ przewidywañ
drugiego modelu by³a oceniana wzglêdem metryk wyliczonych w sposób tradycyjny,
podstawiaj¹c wartoœci do wzorów przedstawionych w podrozdziale \ref{MiaryHRV}.
Do obliczeñ wykorzystano równie¿ szczyty R zidentyfikowane przez sieæ UNet.

\subsection{Warianty modeli oraz ich trening}
W ramach eksperymentu rozwa¿ano ró¿ne konfiguracje i zakresy miar HRV oraz RSA
przewidywanych przez sieæ. Analizowane warianty obejmowa³y miêdzy innymi:
przewidywanie wy³¹cznie SDNN, wy³¹cznie RMSSD, jednoczesne przewidywanie SDNN i
RMSSD, a tak¿e przewidywanie znormalizowanych miar LF i HF.

Do ewaluacji modelu wykorzystano zbiór w³asny, zawieraj¹cy sumarycznie ok. 48h
zapisu sygna³u EKG oraz metodê 5-krotnej walidacji krzy¿owej, s³u¿¹cej
wiarygodnej ocenie jakoœci przewidywañ

\subsection{Wyniki}
Œrednie wyniki walidacji krzy¿owej dla wybranych modeli przedstawiono w tabelach \ref{wyniki_hrv_pojedyncze_rr}, \ref{wyniki_hrv_wiele_rr} oraz \ref{wyniki_hrv_wiele_rr2}.
\begin{table}[ht]
    \captionsetup{justification=centering}
    \caption{Œrednie wyniki walidacji krzy¿owej dla modeli przewiduj¹cych pojedyncze miary.}
    \centering
    \begin{tabular}{|l|c|c|c|c|c|c|}
        \hline
        \textbf{Wariant} & \textbf{SDNN}     & \textbf{RMSSD}    \\ \hline
        MAE              & $6,02 \pm 0,38$   & $6,74 \pm 1,83$   \\ \hline
        MSE              & $65,07 \pm 16,21$ & $96,73 \pm 62,92$ \\ \hline
        RMSE             & $8,01 \pm 0,94$   & $9,32 \pm 3,15$   \\ \hline
        R2               & $0,93 \pm 0,02$   & $0,74 \pm 0,15$   \\ \hline
    \end{tabular}
    \label{wyniki_hrv_pojedyncze_rr}
\end{table}

\begin{table}[ht]
    \captionsetup{justification=centering}
    \caption{Œrednie wyniki walidacji krzy¿owej dla modeli przewiduj¹cych wiele miar.}
    \centering
    \begin{tabular}{|l|c|c|c|c|c|c|}
        \hline
        \textbf{Wariant} & \multicolumn{2}{|c|}{SDNN i RMSSD} & \multicolumn{2}{|c|}{\textbf{LF norm i HF norm}}                                     \\ \hline
        \textbf{Miara}   & \textbf{SDNN}                      & \textbf{RMSSD}                                        & \textbf{LF norm}     & \textbf{HF norm}     \\ \hline
        MAE              & $7,43 \pm 1,38$                    & $5,09 \pm 1,55$                                       & $\sim0,06$      & $\sim0,06$      \\ \hline
        MSE              & $92,12 \pm 31,91$                  & $63,32 \pm 62,83$                                     & $\sim0,01$      & $\sim0,01$      \\ \hline
        RMSE             & $9,46 \pm 1,65$                    & $7,22 \pm 3,35$                                       & $0,08 \pm 0,01$ & $0,08 \pm 0,01$ \\ \hline
        R2               & $0,91 \pm 0,03$                    & $0,84 \pm 0,12$                                       & $0,52 \pm 0,10$ & $0,52 \pm 0,10$ \\ \hline
    \end{tabular}
    \label{wyniki_hrv_wiele_rr}
\end{table}

\begin{table}[ht]
    \captionsetup{justification=centering}
    \caption{Œrednie wyniki walidacji krzy¿owej dla modeli przewiduj¹cych wiele miar.}
    \centering
    \begin{tabular}{|l|c|c|c|c|c|c|}
        \hline
        \textbf{Wariant} & \multicolumn{4}{|c|}{\textbf{SDNN, RMSSD, LF, HF}}                                                                       \\ \hline
        \textbf{Miara}   & \textbf{SDNN}                                      & \textbf{RMSSD}    & \textbf{LF}             & \textbf{HF}           \\ \hline
        MAE              & $15,01 \pm 2,22$                                   & $6,85 \pm 0,99$   & $159,79 \pm 22.47$      & $63,08 \pm 5,95$      \\ \hline
        MSE              & $407,33 \pm 115,64$                                & $89,15 \pm 46,72$ & $60515,62 \pm 24793,08$ & $8725,61 \pm 1682,30$ \\ \hline
        RMSE             & $19,99 \pm 2,80$                                   & $9,19 \pm 2,18$   & $240,89 \pm 49,86$      & $92,96 \pm 9,16$      \\ \hline
        R2               & $0,60 \pm 0,08$                                    & $0,76 \pm 0,10$   & $0,78 \pm 0,08$         & $0,68 \pm 0,05$       \\ \hline
    \end{tabular}
    \label{wyniki_hrv_wiele_rr2}
\end{table}

Modele przewiduj¹ce 

\FloatBarrier
\section{Przewidywanie miar HRV oraz RSA za pomoc¹ sieci typu end-to-end}

\subsection{Wprowadzenie}
Celem niniejszego eksperymentu by³o zbadanie mo¿liwoœci zaprojektowanej sieci
typu end-to-end do przewidywania miar HRV oraz RSA, opisanej szczegó³owo w
podrozdziale \ref{siec-end-to-end}. Przegl¹d literatury nie wykaza³ istnienia
podobnych rozwi¹zañ dzia³aj¹cych w ten sposób, co podkreœla innowacyjny
charakter proponowanego podejœcia. Jednoczeœnie brak takich rozwi¹zañ
uniemo¿liwia bezpoœrednie porównanie wyników z innymi badaniami. Eksperyment
mia³ na celu ukazanie potencjalnych mo¿liwoœci tego modelu oraz jego
skutecznoœci w przewidywaniu wybranych miar, na podstawie danych EKG
pochodz¹cych z rejestratora Polar H10.

\subsection{Warianty modeli}
W eksperymencie przeanalizowano ró¿ne warianty zaproponowanej sieci, ró¿ni¹ce
siê iloœcia oraz rodzajem przewidywanych miar HRV i RSA. Rozwa¿ano podobne
konfiguracje jak w przypadku eksperymentu przedstawionego w podrodziale
\ref{RRsiec}. Obejmowa³y one m. in. przewidywanie pojedynczych miar takich jak
SDNN czy RMSSD oraz przewidywanie wielu miar na raz, na przyk³ad jednoczesne
przewidywanie SDNN i RMSSD oraz znormalizowanych wartoœci LF i HF.

\subsection{Przygotowanie danych}
Dane do eksperymentu pochodzi³y z w³asnych nagrañ EKG zarejestrowanych za
pomoc¹ Polar H10, obejmuj¹cych ³¹cznie oko³o 48 godzin. Do treningu i
przewidywañ wykorzystano 5-minutowe fragmenty sygna³u, które wczeœniej
znormalizowano do zakresu od -1 do 1. Wartoœci referencyjne miar by³y obliczane
na podstawie oznaczeñ za³amków R, wytworzonych przez sieæ UNet oraz wzorów
przedstawionych w podrodziale \ref{MiaryHRV}. Wykorzystano wariant sieci
przetrenowany na zaszumionym zbiorze, który by³ przedmiotem szerszej analizy w
poprzednim eksperymencie.

\subsection{Trening oraz metoda ewaluacji skutecznoœci}
Trening ka¿dego modelu przeprowadzono w jednolitych warunkach: przez 150 epok z
u¿yciem funkcji straty MSE oraz optymalizatora Adam.

Skutecznoœæ ka¿dego wariantu sieci oceniono za pomoc¹ 5-krotnej walidacji
krzy¿owej, co zapewni³o wiarygodn¹ ocenê jakoœci przewidywañ oraz umo¿liwi³o
porównanie wyników miêdzy ró¿nymi konfiguracjami modeli.

\subsection{Wyniki}
Œrednie wyniki uzyskane w ramach walidacji krzy¿owej dla wybranych modeli przedstawiono w tabelach \ref{wyniki_hrv_pojedyncze} oraz \ref{wyniki_hrv_wiele}.

\begin{table}[ht]
    \captionsetup{justification=centering}
    \caption{Œrednie wyniki walidacji krzy¿owej dla modeli przewiduj¹cych pojedyncze miary.}
    \centering
    \begin{tabular}{|l|c|c|c|c|c|c|}
        \hline
        \textbf{Wariant} & \textbf{SDNN}       & \textbf{RMSSD}      \\ \hline
        MAE              & $11,22 \pm 2,15$    & $12,06 \pm 7,26$    \\ \hline
        MSE              & $319,90 \pm 185,50$ & $486,95 \pm 488,95$ \\ \hline
        RMSE             & $17,70 \pm 5,00$    & $19,48 \pm 10,37$   \\ \hline
        R2               & $0,7 \pm 0,17$      & $-0,61 \pm 1,74$    \\ \hline
    \end{tabular}
    \label{wyniki_hrv_pojedyncze}
\end{table}

\begin{table}[ht]
    \captionsetup{justification=centering}
    \caption{Œrednie wyniki walidacji krzy¿owej dla modeli przewiduj¹cych wiele miar.}
    \centering
    \begin{tabular}{|l|c|c|c|c|c|c|}
        \hline
        \textbf{Wariant} & \multicolumn{2}{|c|}{SDNN i RMSSD} & \multicolumn{2}{|c|}{\textbf{LF norm i HF norm}}                                     \\ \hline
        \textbf{Miara}   & \textbf{SDNN}                      & \textbf{RMSSD}                                        & \textbf{LF norm}     & \textbf{HF norm}     \\ \hline
        MAE              & $9,69 \pm 0,56$                    & $8,32 \pm 1,84$                                       & $0,07 \pm 0,01$ & $0,07 \pm 0,01$ \\ \hline
        MSE              & $191,71 \pm 31,69$                 & $141,93 \pm 49,51$                                    & $\sim0,01$      & $\sim0,01$      \\ \hline
        RMSE             & $13,80 \pm 1,17$                   & $11,70 \pm 2,23$                                      & $0,09 \pm 0,01$ & $0,09 \pm 0,01$ \\ \hline
        R2               & $0,81 \pm 0,04$                    & $0,58 \pm 0,13$                                       & $0,42 \pm 0,07$ & $0,42 \pm 0,07$ \\ \hline
    \end{tabular}
    \label{wyniki_hrv_wiele}
\end{table}

Ku zaskoczeniu, najlepsz¹ jakoœæ przewidywañ osi¹gn¹³ model jednoczeœnie
przewiduj¹cy SDNN i RMSSD. Uzyska³ on œredni wynik wspó³czynnika $R^2$ na
poziomie ok. 0,8 dla SDNN oraz ok. 0,58 dla RMSSD, co przewy¿sza³o rezultaty
uzyskane przez modele przewiduj¹ce te miary oddzielnie. Moze to wynikaæ z
wystêpuj¹cej miêdzy tymi miarami korelacji, która u³atwia modelowi rozpoznanie
bardziej z³o¿onych zale¿noœci. Wyniki tego wariantu dla jednego z foldów
walidacji krzy¿owej przedstawiono na Rys \ref{fig/SDNN_RMSSD}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.25]{Rysunki/SDNN i RMSSD.png}
    \caption{Wyniki przewidywañ SDNN oraz RMSSD dla jednego z foldów}
    \label{fig/SDNN_RMSSD}
\end{figure}

Ni¿szy wynik wspó³czynnika determinacj RMSSD, wzglêdem SDNN w tym modelu mo¿e
byæ zwi¹zany z ró¿nic¹ w ich typowych wartoœciach. Zastosowana funkcja straty
MSE, faworyzuje redukcjê b³êdów dla miar o wy¿szych wartoœciach, co mo¿e
prowadziæ do niedoszczacowania wartoœci o mniejszym zakresie.

Wynikiem akceptowalnym wykaza³ sie wariant przewiduj¹cy jedynie SDNN, który
uzyska³ wspó³czynnik $R^2$ na poziomie $0,7\pm0.17$. Pozosta³e warianty
wykaza³y nisk¹ zgodnoœæ przewidywañ z rzeczywistoœci¹, co wskazuje na trudnoœci
modelu w nauce tych miar i ogranicza ich praktyczn¹ u¿ytecznoœæ.

Najwiêkszym zaskoczeniem w trakcie przeprowadzania badania okaza³a sie bardzo
wysoka niespójnoœæ wyników miêdzy foldami w walidacji krzy¿owej dla RMSSD. By³a
ona znacznie wiêksza ni¿ w przypadku innych sprawdzanych wariantów. Podczas
analizy foldów stwierdzono, ¿e pomimo dobrych rokowañ na niektórych zbiorach,
model nie generalizuje siê zbyt dobrze i osi¹ga mocno skrajne wyniki w
zale¿noœci od testowanych danych. Przyk³ad ogromnej ró¿nicy miêdzy dwoma
foldami przedstawiono na Rys. \ref{fig/RMSSD_2_folds}

W ramach ekperymentu, testowano równie¿ warianty sieci przewiduj¹ce wiêksz¹
liczbê miar ni¿ dwie, jednak ¿aden z tych modeli nie osi¹gn¹³ wyników
porównywalnych do wariantów przedstawionych w tej sekcji.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.25]{Rysunki/RMSSD_2_folds.png}
    \caption{Wyniki przewidywañ RMSSD dla dwóch foldów}
    \label{fig/RMSSD_2_folds}
\end{figure}

\subsection{Wnioski}
Zaproponowany model end-to-end wykaza³ siê przyzwoit¹ dok³adnoœcia w wariancie,
w którym przewidywano jednoczeœnie wartoœci SDNN oraz RMSSD. Wyniki te nie by³y
jednak na tyle dok³adne, aby uzasadniæ u¿ycie tego modelu zamiast tradycyjnych
podejœæ, opartych g³ównie na wczeœniejszym wyznaczeniu za³amków R i ich
analizie za pomoc¹ klasycznych wzorów. Mimo to warto podkreœliæ, ¿e
zastosowanie modelu end-to-end niesie za sob¹ istotne zalety, takie jak
prostota u¿ycia, ograniczenie liczby etapów przetwarzania czy krótszy czas
analizy. Co wiêcej mo¿liwe, ¿e wytrenowanie tego typu modelu na du¿ej iloœci,
dobrze oznaczonych danych mog³oby zwiêkszyæ jego skutecznoœæ, umo¿liwiaj¹c
dok³adne dzia³anie nawet w przypadkach, gdzie wykrywanie za³amków R mo¿e byæ
utrudnione lub niemo¿liwe.

Warto przypomnieæ, ¿e przegl¹d literatury nie wykaza³ wczeœniejszego
zastosowania podejœcia end-to-end do przewidywania metryk HRV oraz RSA
bezpoœrednio z sygna³u EKG. Prezentowane w niniejszej pracy rozwi¹zanie ma
zatem charakter nowatorski, a ocena jego skutecznoœci jest relatywnie trudna ze
wzglêdu na brak wczeœniejszych badañ w tej dziedzinie. Fakt ten w po³¹czeniu z
dobrze rokuj¹cymi wynikami, wskazuje na potencja³ rozwojowy tej metody. Dalsze
prace nad jej udoskonaleniem mog¹ prowadziæ do stworzenia bardziej
uniwersalnego oraz dok³adnego narzêdzia analizy tych metryk.

