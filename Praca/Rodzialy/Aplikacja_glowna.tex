\section{Aplikacja g³ówna \small{(autor: Jakub Wojtalewicz)}}
Na potrzeby niniejszej pracy stworzono aplikacjê, która umo¿liwia pobieranie i
przetwarzanie sygna³ów EKG w czasie rzeczywistym lub na podstawie
zaimportowanych wczeœniej danych. Aplikacja wykorzystuje zaawansowane narzêdzia
analityczne do oceny zmiennoœci rytmu serca oraz zmian zwi¹zanych z rytmem
oddechowym. Wyniki analiz s¹ prezentowane u¿ytkownikowi zarówno w formie
precyzyjnie obliczonych miar, jak i czytelnych wizualizacji ukazuj¹cych ich
zmiany w funkcji czasu, co u³atwia ocenê ogólnej zmiennoœci rytmu serca.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{Rysunki/aplikacja.png}
    \caption{Zrzut ekranu prezentuj¹cy dzia³anie aplikacji w trybie domyœlnym}
    \label{fig/apli}
\end{figure}

\FloatBarrier

\subsection{Tryby pracy aplikacji}
Aplikacja oferuje trzy tryby pracy: domyœlny, symulacji oraz ³adowania danych z
pliku. Niezale¿nie od wybranego trybu, aplikacja zapewnia te same podstawowe
funkcje. W ka¿dym z trybów odbywa siê rysowanie wykresu sygna³u EKG, wykrywanie
szczytów R, obliczanie miar HRV oraz prezentacja wyników. Miary czasowe takie
jak SDNN, RMSSD, MEAN RR czy PNN50 oraz czêstotliwoœciowe jak LF, HF czy ich
stosunek s¹ obliczane na podstawie odstêpów RR i wyœwietlane u¿ytkownikowi, a
wykres sygna³u jest na bie¿¹co aktualizowany lub generowany po zakoñczeniu
analizy.

\subsection*{Tryb domyœlny}
W trybie domyœlnym aplikacja dzia³a w czasie rzeczywistym, odbieraj¹c dane z
urz¹dzenia Polar H10 za poœrednictwem aplikacji poœrednicz¹cej. Po otwarciu
portu komunikacyjnego kolejne pakiety danych s¹ przetwarzane na bie¿¹co, co
umo¿liwia rysowanie wykresu sygna³u EKG oraz dynamiczne obliczanie miar HRV w
momencie ich nap³ywu. Wyniki s¹ regularnie aktualizowane i prezentowane
u¿ytkownikowi w czasie rzeczywistym. Aplikacja do realizacji wczeœniej
wymienionych funkcjonalnoœci wykorzystuje dwa w¹tki, w celu uniezale¿nienia
operacji odbierania danych od operacji ich przetworzenia. Jeden w¹tek
odpowiedzialnych jest za odbieranie nadchodz¹cych pakietów oraz zapisywanie ich
do odpowiedniej struktury danych, z której drugi nastêpnie te dane wyci¹ga i
dokonuje ich przetworzenia.

Aby unikn¹æ konfliktów w dostêpie do wspó³dzielonych zasobów miêdzy w¹tkami,
zastosowano mechanizm synchronizacji oparty na semaforach. W tym celu
wykorzystano obiekt \emph{Lock} z modu³u \emph{threading}, który umo¿liwia
kontrolê dostêpu do wspó³dzielonych zmiennych i zasobów. Dziêki zastosowaniu
tego rozwi¹zania dane s¹ przetwarzane w sposób spójny i bezpieczny.

\subsection*{Tryb symulacji}
Tryb symulacji dzia³a podobnie do trybu domyœlnego, z t¹ ró¿nic¹, ¿e dane nie
s¹ pobierane z zewnêtrznego Ÿród³a, lecz wczytywane z pliku. Za obs³ugê tego
procesu odpowiada dedykowany w¹tek aplikacji, który odczytuje sygna³, dzieli go
na pakiety i przesy³a na odpowiedni port aplikacji.

Takie podejœcie umo¿liwia przetwarzanie danych w sposób symuluj¹cy rzeczywisty
nap³yw informacji. Dziêki temu mo¿na testowaæ algorytmy w kontrolowanych
warunkach na wczeœniej zebranych danych, co pozwala na ich dok³adn¹ weryfikacjê
i optymalizacjê przed zastosowaniem w trybie rzeczywistym.

\subsection*{Tryb ³adowania danych z pliku}
W trybie ³adowania danych z pliku aplikacja wczytuje ca³y zapis sygna³u EKG
jednorazowo i przetwarza go w ca³oœci. Analiza obejmuje pe³ny zestaw danych,
bez ich dzielenia na pakiety. Po zakoñczeniu przetwarzania u¿ytkownik otrzymuje
wykres obrazuj¹cy pe³ny przebieg sygna³u oraz zestaw obliczonych miar HRV. W
tym trybie dostêpne s¹ trzy opcje ³adowania plików: wczytanie pliku CSV
zawieraj¹cego dane z czujnika Polar H10 w formacie "timestamp-wartoœæ",
za³adowanie danych pacjenta ze zbioru MIT-BIH lub zbioru MIT-BIH Noise Stress.

\subsection{Komponent odpowiedzialny za znajdywanie szczytów R}\label{subsec:wykrywacz}
Aplikacja wykorzystuje dedykowany komponent do lokalizowania szczytów R w
sygnale EKG, którego implementacja jest w pe³ni modu³owa i elastyczna.
Komponent ten, zwany „detektorem szczytów”, jest wstrzykiwany jako parametr
konstruktora do obiektu odpowiedzialnego za przechowywanie i analizê danych
EKG. Dziêki temu mo¿liwa jest ³atwa wymiana lub dostosowanie algorytmu detekcji
w zale¿noœci od potrzeb i specyfikacji analizy.

U¿ywany rodzaj detektora szczytów zale¿y od wybranego algorytmu detekcji w
pliku konfiguracyjnym. Ka¿dy znajdywacz implementuje wspólny interfejs, co
zapewnia jednolit¹ strukturê i transparentnoœæ dzia³ania niezale¿nie od
zastosowanego algorytmu. Interfejs definiuje zestaw metod, które znajdywacz
musi zaimplementowaæ, w tym kluczow¹ metodê s³u¿¹c¹ do lokalizowania szczytów w
przekazanym fragmencie sygna³u. Taka architektura pozwala na ³atw¹ integracjê
nowych algorytmów bez koniecznoœci modyfikowania pozosta³ych elementów systemu.

\subsection{Mechanizm dodawania szczytów R w czasie rzeczywistym}
Aplikacja rozpoczyna proces wykrywania szczytów R dopiero po zgromadzeniu co
najmniej dwusekundowego fragmentu sygna³u EKG. Po spe³nieniu tego warunku, przy
ka¿dym odebraniu nowych danych, system przechodzi do analizy fragmentu sygna³u
zaczynaj¹c od ostatnio wykrytego szczytu R. Jeœli do tej pory nie
zidentyfikowano ¿adnego szczytu, analiza rozpoczyna siê od pocz¹tku sygna³u.

Fragment sygna³u przekazywany jest do komponentu odpowiedzialnego za
identyfikacjê szczytów R. Po ich wykryciu, aplikacja zapisuje jedynie te, które
s¹ oddalone od koñca przekazanego przedzia³u o co najmniej po³owê œredniej
ró¿nicy miêdzy trzema wczeœniej wykrytymi szczytami R. Mechanizm ten zapobiega
b³êdnemu rozpoznaniu szczytów w przypadkach, gdy sygna³ koñczy siê na zboczu
fali R, uniemo¿liwiaj¹c algorytmowi poprawne okreœlenie jego maksymalnej
wartoœci. Takie podejœcie pozwala na uzyskanie wiêkszej precyzji w detekcji
szczytów i minimalizuje ryzyko b³êdów wynikaj¹cych z niepe³nych danych. Bez
tego rozwi¹zania zdarza³y siê sytuacje, w których szczyt by³ oznaczany na
rosn¹cym zboczu za³amka R zamiast na jego w³aœciwym wierzcho³ku. Przyk³ad
takiej b³êdnej klasyfikacji przedstawiono na Rys. \ref{fig/zleWykrytySzczyt}

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{Rysunki/zleZaznaczonySczyt.png}
    \caption{Przyk³ad Ÿle zaznaczonego szczytu}
    \label{fig/zleWykrytySzczyt}
\end{figure}

\subsection{Mechanizm zdarzeñ}
Aplikacja zosta³a wyposa¿ony w mechanizm zdarzeñ (eventów), który umo¿liwia
dynamiczne powiadamianie warstwy prezentacji o zmianach w danych. Gdy wykrywane
s¹ nowe szczyty R lub aktualizowane s¹ wartoœci miar HRV, mechanizm zdarzeñ
automatycznie wywo³uje odœwie¿enie wykresów oraz wartoœci metryk w interfejsie
u¿ytkownika. Pozwala to na p³ynne monitorowanie wyników w czasie rzeczywistym,
co jest szczególnie istotne w aplikacjach pracuj¹cych na danych dynamicznie
nap³ywaj¹cych. Przy wspó³pracy z urz¹dzeniem Polar H10, wykres œrednio
odœwie¿any jest co 73/130 sekundy. Wynika to ze sposobu przesy³ania danych
przez urz¹dzenie pomiarowe, które rejestruje sygna³ z czêstotliwoœcia
próbkowania 130Hz i wysy³a je w pakietach zawieraj¹cych 73 próbki sygna³u.
Mechanizm ka¿dorazowego odœwie¿ania wykresu przy aktualizacji danych mo¿na
zast¹piæ odœwie¿aniem co dany okres czasu, poprzez modyfikujcjê pliku
konfiguracyjnego.

\subsection{Mechanizm dzielenia sygna³u na okna}
W celu u³atwienia analizy i przygotowania danych do treningu modeli uczenia
maszynowego zaimplementowano mechanizm dzielenia sygna³u EKG na okna o
okreœlonym rozmiarze. Do ka¿dego wyznaczonego okna mo¿na do³¹czyæ dodatkowe
informacje odnoœnie jego zawartoœci. Przyk³adowymi informacjami s¹: pozycje
szczytów R, wartoœci miar HRV takich jak SDNN, RMSSD, LF, HF, LF/HF czy wektor
binarny, który wskazuje, czy dana próbka jest szczytem R (1) czy nie (0). Dane
w obrêbie okna mog¹ równie¿ zostaæ znormalizowane do porz¹danego zakresu, na
przyk³ad od -1 do 1.

